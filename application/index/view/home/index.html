{layout name="public/layout" /}

  <div class="container" style="margin-top:3em;">

  	<div class="row">
		<div class="col-md-9">
			<div class="banner">
			    <a href="#">
			      <img src="__PUBLIC__{$infos->head}" alt="" width="150px" height="150px" class="img-thumbnail" style="position:relative;top:11em;left:1.5em;">
			    </a>
			    <a href="" style="position:relative;top:11em;left:2em;">
					<strong style="color:white;font-size:24px;"> {$infos->name} </strong>
			    </a>
			    <a href="" style="position:relative;top:7.5em;right:2em;color:white;font-size:24px;">
					({$infos->address})
			    </a>


			<!-- menu -->
			<div class="pull-right hidden-xs" style="position:relative;top:18em;padding-right:1em;">

						  
				<!-- 好友 -->
				<!--<div class="btn-group">
				  <button type="button" class="btn btn-default btn-xs"> <i class="icon-user"></i> 好友</button>
				  <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
				    <span class="caret"></span>
				    <span class="sr-only">Toggle Dropdown</span>
				  </button>
				  <ul class="dropdown-menu" role="menu">
				    <li><a href="#">接受通知</a></li>
				    <li class="divider"></li>
				    <li><a href="#">密友</a></li>
				    <li><a href="#">普通朋友</a></li>
				    <li><a href="#">添加到其他名单</a></li>
				    <li class="divider"></li>
				    <li><a href="#">推荐好友</a></li>
				    <li class="divider"></li>
				    <li><a href="#">删除好友</a></li>
				  </ul>
				</div>-->
				<!-- 好友 -->

				<!-- 已关注 -->
				<div class="btn-group">
				  

					  <?php if( in_array( $infos->uid,$guan ) ): ?>
						<button type="button" class="btn btn-default btn-xs" onclick="delFriend('{$infos->uid}')">
								<i class="icon-ok"></i> 已关注
						</button>
					 <?php else: ?>
						<button type="button" class="btn btn-default btn-xs" onclick="addFriend('{$infos->uid}')">
								<i class="icon-plus"></i> 关注
						</button>
					  <?php endif; ?>
					   
				  

				  <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
				    <span class="caret"></span>
				    <span class="sr-only">Toggle Dropdown</span>
				  </button>
				  <ul class="dropdown-menu" role="menu">
				  	<center> <span style="color:gray;font-size:12px;">在动态消息中</span> </center> 
				    <li><a href="javascript:;">优先查看</a></li>
				    <li><a href="javascript:;">默认设置</a></li>
				    <li><a href="javascript:;" onclick="delFriend('{$infos->uid}')">停止关注</a></li>
				  </ul>
				</div>
				<!-- 已关注 -->


				<!-- 发消息 -->
				<button type="button" class="btn btn-default btn-xs"> <i class="icon-comment"></i> 发消息</button>
				<!-- 发消息 -->

				<!-- ... -->
				<div class="btn-group">
				  <button type="button" class="btn btn-default btn-xs"> <i></i> ... </button>
				  <button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown">
				    <span class="caret"></span>
				    <span class="sr-only">Toggle Dropdown</span>
				  </button>
				  <ul class="dropdown-menu" role="menu">
				    <li><a href="#">查看友情</a></li>
				    <li><a href="#">视频通话</a></li>
				    <li class="divider"></li>
				    <li><a href="#">打招呼</a></li>
				    <li class="divider"></li>
				    <li><a href="#">举报</a></li>	    
				    <li><a href="#">拉黑</a></li>	    
				  </ul>
				</div>
				<!-- ... -->

			</div>
			<!-- menu -->


			</div>

			<!-- banner-menu-list -->
			<div class="banner-menu-list">
				<ul class="hidden-xs col-xs-offset-4 col-sm-offset-4 col-md-offset-4 col-sm-6 col-md-6">
					<li> <a href="">时间线</a> </li>
					<li> <a href="">简介</a> </li>
					<li> <a href="">好友</a> <span>1个共同好友</span> </li>
					<li> <a href="">照片</a> </li>
					<li> <a href="">更多</a> </li>
				</ul>
			</div>
			<!-- banner-menu-list -->


		</div>
  	</div>
	<!-- row -->

	<br class="visible-xs">

	<!-- row -->
	<div class="row">

		<!-- left -->
		<div class="col-md-3 ">

			<div class="home-intro" style="background-color:white;">
				<ul>
					<li> <i class="icon-large icon-globe" style="color:#4267B2;"></i> <strong>介绍</strong> </li>
					<li> <i class="icon-home" style="color:#A5A9B3;"></i> 曾经就读于 {$infos->edu}</li>
					<li> <i class="icon-home" style="color:#A5A9B3;"></i> 所在地: {$infos->address}</li>
					<li> <i class="icon-heart" style="color:#A5A9B3;"></i> {$infos->state}</li>
					<li> <i class="icon-user-md" style="color:#A5A9B3;"></i> 年龄:{$infos->age}</li>
				</ul>
			</div>

			<!--<div class="home-phone col-xs-12 col-sm-12 col-md-12" >
				<ul class="col-xs-12 col-sm-12 col-md-12">
					<li> <i class="icon-large icon-camera" style="color:#4267B2;"></i> <strong>照片</strong> </li>
					<ul>
						<li> <a href=""> <img src="./head-test.jpg" alt="" width="80px" height="80px">  </a> </li>
						<li> <a href=""> <img src="./head-test.jpg" alt="" width="80px" height="80px">  </a> </li>
						<li> <a href=""> <img src="./head-test.jpg" alt="" width="80px" height="80px">  </a> </li>
						<li> <a href=""> <img src="./head-test.jpg" alt="" width="80px" height="80px">  </a> </li>
						<li> <a href=""> <img src="./head-test.jpg" alt="" width="80px" height="80px">  </a> </li>
						<li> <a href=""> <img src="./head-test.jpg" alt="" width="80px" height="80px">  </a> </li>
					</ul>
				</ul>
			</div>-->

			<!-- 好友 -->
			<div class="home-friend col-xs-12 col-sm-12 col-md-12" >
				<ul class="col-xs-12 col-sm-12 col-md-12">
					<li>
						<i class="icon-large icon-group" style="color:#4267B2;"></i> 
						<strong>好友</strong>  
						<span>{:count($friend)}</span>
					</li>
					<ul>
						{volist name="friend" id="vo"}
							<li> 
								<a href="{:url('/Home/index/uid/'.$vo->fid)}"> <img src="__PUBLIC__{$vo->head}" alt="" width="80px" height="80px"> </a> 
								<br>
								<a href="{:url('/Home/index/uid/'.$vo->fid)}">  {:mb_substr($vo->name,0,10,'utf-8');}</a>  
							</li>
						{/volist}
				</ul>
			</div>
			<!-- 好友 -->


			<!-- fans -->
			<div class="home-friend col-xs-12 col-sm-12 col-md-12" >
				<ul class="col-xs-12 col-sm-12 col-md-12">
					<li>
						<i class="icon-large icon-group" style="color:#4267B2;"></i> 
						<strong>粉丝</strong>  
						<span>{:count($fans)}</span>
					</li>
					<ul>
						{volist name="fans" id="value"}
							<li> 
								<a href="{:url('/Home/index/uid/'.$value->uid)}"> <img src="__PUBLIC__{$value->head}" alt="" width="80px" height="80px"> </a> 
								<br>
								<a href="{:url('/Home/index/uid/'.$value->uid)}">  {:mb_substr($value->name,0,10,'utf-8');}</a>  
							</li>
						{/volist}
				</ul>
			</div>
			<!-- fans -->	



		</div>
		<!-- left -->

		<!-- center -->
		<div class="col-xs-12 col-sm-12 col-md-6 pull-left" style="padding-left:1em;">


<?php if( session('uid') == $infos->uid ): ?>
			<div>
				<script type="text/plain" id="myEditor" style="width:100%;height:6em;"></script>
				<script>
				   
					var um = UM.getEditor('myEditor', {
						toolbar:[
				            'forecolor link |','emotion image video ',
				        ],
					});
				</script>
			</div>

			<div class="col-xs-12 col-sm-12 col-md-12 pull-left" style="padding-top:0.5em;">
				<button type="button" class="btn btn-primary btn-xs pull-right submit"> 发 布 </button>
			</div>
<?php endif; ?>



{volist name="blog" id="vo" key="k"}


		<!-- list -->
		<div class="col-xs-12 col-sm-12 col-md-12 
		{:$vo->share != 0 ? 'share' :null;}
		
		 comment-list comment-list-{$k} comment-lists-{$vo->uid}">

			<ul class="col-sm-12 col-md-12">			
				<li>
				    <a href="{:url('/Home/index/uid/'.$vo->uid)}">
				      <img src="__PUBLIC__{$vo->head}" alt="" width="40px" height="40px">
				    </a>
				</li>
				<li> 
					<a href="{:url('/Home/index/uid/'.$vo->uid)}"> <strong style="color:#365899;">{$vo->name}</strong> </a> 
				</li>

				<li class="dropdown pull-right" style="position:relative;right:-1em;top:-1.2em;">
		          <a href="#" class="dropdown-toggle" data-toggle="dropdown" style="color:gray;">  
		          	<span class="icon-angle-down" style="text-decoration:none;"></span>
		          </a>
		          <ul class="dropdown-menu" role="menu">
		            <li><a href="#" class="icon-remove" onclick="closeWindows('{$k}')"> 隐藏</a></li>

					<?php if( session('uid') == $vo->uid): ?>
						<li><a href="javascript:;" onclick="delBlog('{$vo->id}','{$vo->uid}')" class="icon-remove-sign"> 删除 </a></li>
					<?php endif; ?>

		            <li class="divider"></li>
		            <li><a href="#" class="icon-info-sign"> 举报帖子</a></li>
		            <li><a href="#" class="icon-heart"> 收藏帖子</a></li>

		          </ul>
		        </li> 

				<li style="clear:both;position:relative;right:-4em;top:-1.5em;" > 
					<a href="" style="color:gray;font-size:12px;"> {:date('m-d H:i',$vo->add_time)} </a> 
				</li>

				<li style="margin-top:-1em;" class="pull-left col-xs-12 col-sm-12 comment-content">
					<p>
						{$vo->content}
					</p>	
					<hr>			
				</li>

				<li class="col-xs-12 col-sm-12 col-md-12 comment-tool">
					<span onclick="praise('{$vo->id}',this)" class="
						
					{volist name="praise" id="praises"} 
						<?php if($praises->bid==$vo->id): ?>
							praise
						<?php endif; ?>
					{/volist}
						
						">  <i class="icon-thumbs-up"></i> <a href="javascript:;"> 赞</a> </span> 

					<span>  <i class="icon-comment"></i> <a href="javascript:;"> 评论</a> </span> 
					<span onclick="share('{$vo->id}')">  <i class="icon-share-alt"></i> <a href="javascript:;"> 转发</a> </span> 

				{gt name="vo->share" value="0"}
					<span class="pull-right getShareName" onclick="getShareName('{$vo->share}',this)"> 
						<strong> 
							转自  <a href=""> {$vo->share} </a>  
						</strong> 
					</span> 
				{/gt}

					
				</li>
			</ul>
			
		</div>	
		

		<!-- 评论列表 -->
		<div class="col-xs-12 col-sm-12 col-md-12 comment-list-content comment-list-content-{$k} comment-list-contents-{$vo->uid}">
			<ul class="col-xs-12 col-sm-12">
				<li onclick="getName('{$vo->id}',this)" class="getName">
					<i class="icon-thumbs-up" style="color:#5890FF;"></i>
					<a href="javascript:;" > 布尔和其他 0 位用户 </a>
					<hr style="margin-top:0.3em;">
				</li>

      <?php  foreach($comment as $value): ?>  		
				<?php if( $value->bid === $vo->id ): ?>	
					<li class="comment-list-contents">
						<div>
								<a href="{:url('/Home/index/uid/'.$value->uid)}" class="pull-left">
									<img src="__PUBLIC__{$value->head}" alt="" width="35px" height="35px">
								</a>
								<a href="{:url('/Home/index/uid/'.$value->uid)}" class="pull-left"> <strong>{$value->name}</strong> </a> : 						
						</div>
						<div class="pull-right" style="position:relative;left:-2.2em;top:-2.1em;">
							<!--<a href="">赞</a>-->
							<a href="javascript:;" onclick="replys('{$k}','{$value->name}')">回复</a>
							<a href="javascript:;" style="color:#90949C;">{:date('m-d H:i',$value->add_time)}</a>

							<?php if( session('uid') == $value->uid): ?>
									<a href="javascript:;" onclick="delComment('{$value->cid}',this)">删除</a>
							<?php endif; ?>

						</div>
						<div class="clearfix">
							{$value->content}
						</div>

							<br class="visible-xs">
					</li>
					<?php endif; ?>
				<?php endforeach; ?>

				<li>
					<!-- comment-box -->
					<div class="col-sm-12 col-md-12" style="margin-top:1em;">			

				<form action="" method="post" id="Editor{$k}-1">	
						<script type="text/plain" id="Editor{$k}" style="width:100%;height:2em;"></script>
						<script>
						    //实例化编辑器
							var um = UM.getEditor('Editor{$k}', {
								toolbar:[
						            'emotion image ',
						        ],
							});
						</script>
					</div>	
					<!-- comment-box -->
					<input type="hidden" name="bid" value="{$vo->id}">

					<div class="col-sm-12 col-md-12 content-commit" style="padding-top:0.5em;margin-bottom:1em;">
						<button type="button" class="btn btn-primary btn-xs pull-right" onclick="submits('Editor{$k}')"> 发 布 </button>
					</div>
				</form>

				</li>

			</ul>
		</div>	

		<!-- list -->

	
{/volist}

	<center>
		{$blog->render()}
	</center>

	</div>
	<!-- comment -->



	</div>
	<!-- row -->


  </div>
<!-- container -->
</body>
</html>
<script>
$(function(){
	$(".submit").click(function(){

			var content=$("#myEditor").html();

			// 发布微博
			$.post("{:url('/Index/save')}", { "content": content },
				function(data){
						if (data.code>0) {
							layer.msg(data.msg);
							setTimeout(function(){
							window.location.reload(); 
							},1000);
							
						}else{
							layer.msg(data.msg);	
						}
					
				}, "json");
	});

	$(".getName").click();

	$(".getShareName").click();

});


// 删除微博
function delBlog(id,fid){

	layer.confirm('真的要删除?', {icon: 3, title:'删除提示'}, function(index){
		$.post("{:url('/Index/delete')}", { "id": id },
			function(data){
			if (data.code>0) {
					layer.msg(data.msg);
					// console.log(data);
					closeWindow(".comment-lists-"+fid)
					closeWindow(".comment-list-contents-"+fid)
				}else{
					layer.msg(data.msg);	
					// console.log(data);
				}
			}
		);	
	layer.close(index);
	});

	

}



// 删除评论
function delComment(id,obj){
	

	layer.confirm('真的要删除?', {icon: 3, title:'删除提示'}, function(index){
		$.post("{:url('/Index/delComment')}", { "id": id },
			function(data){
			if (data.code>0) {
					layer.msg(data.msg);
					// console.log(data);
					$(obj).parents(".comment-list-contents").hide();
				}else{
					layer.msg(data.msg);	
					// console.log(data);
				}
			}
		);	
	layer.close(index);
	});
	
}


//发布评论
function submits(id){

		var data =$("#"+id+"-1").serializeArray();
		$.post("{:url('/Index/comment')}", data,
		   function(data){
		     	if (data.code>0) {
		     		layer.msg(data.msg);
		     		setTimeout(function(){
						window.location.reload(); 
		     		},1000);
		     		
		     	}else{
		     		layer.msg(data.msg);	
		     	}
					//  console.log(data);
		    
		}, "json");
	 		
}


function closeWindow(obj){
	$(obj).hide();
}


// 点赞图标
function praise(bid,obj){
		$.post("{:url('/Index/praise')}", { "bid": bid },
			function(data){
					if (data.code>0) {
						// console.log(data);	
						data.status>0 ? $(obj).css("color","#5890FF") : $(obj).css("color","#AFB4BD");		
						data.status>0 ? $(obj).children("a").css("color","#5890FF") :$(obj).children("a").css("color","#AFB4BD");	
						$(".getName").click();		
					}else{
						layer.msg(data.msg);	
						// console.log(data);
						data.status>0 ? $(obj).css("color","#5890FF") : $(obj).css("color","#AFB4BD");	
						data.status>0 ? $(obj).children("a").css("color","#5890FF") :$(obj).children("a").css("color","#AFB4BD");	
						$(".getName").click();	
					}
				
			}, "json");	
}


// 获取点赞人名字和总数
function getName(bid,obj){

	$.post("{:url('/Index/praiseName')}", { "bid": bid },
		function(data){
			// console.log(data);	
			data.count<=0 ? $(obj).children('a').html('还没有人点赞') : $(obj).children('a').html(data.first+"和其他 "+(data.count-1)+" 位用户"  );							
		}, "json");	

}


// 转发
function share(bid){

	layer.confirm('真的要转发?', {icon: 3, title:'转发提示'}, function(index){

		$.post("{:url('/Index/share')}", { "bid": bid },
			function(data){
				if( data.code >=0){
					layer.msg(data.msg);
					setTimeout(function(){
						window.location.reload(); 
					},1000);
				}else{
					layer.msg(data.msg);
				}

				// console.log(data);		
			}, "json");	
	
	layer.close(index);
	});
	
}

// 转发者名字
function getShareName(uid,obj){
	$.post("{:url('/Index/getShareName')}", { "uid": uid },
		function(data){
			$(obj).children().children("a").html(data.name);
			$(obj).children().children("a").attr("href","{:url('/Home/index/uid/"+data.uid+"')}" );		
			// console.log(data);		
		}, "json");	
}

// 回复
function replys(obj,name){
	// Editor2
	$("#Editor"+obj).html('回复:'+name+"&nbsp;");
	// $("#Editor"+obj).focus();
}


// 删除朋友 取消关注
function delFriend(fid){

	layer.confirm('真的要取消关注?', {icon: 3, title:'取消关注提示'}, function(index){

		$.post("{:url('/Search/delete')}", { "fid": fid, },
			function(data){
			if (data.code>0) {
					layer.msg(data.msg);
					// console.log(data);
					setTimeout(function(){
						window.location.reload();
					},1000);
					
				}else{
					layer.msg(data.msg);	
					// console.log(data);
				}
			}
		);	

	layer.close(index);
	});

}

// 添加 关注
function addFriend(fid){

		$.post("{:url('/Search/addFriend')}", { "fid": fid, },
			function(data){
			if (data.code>0) {
					layer.msg(data.msg);
					// console.log(data);
					setTimeout(function(){
						window.location.reload();
					},1000);
					
				}else{
					layer.msg(data.msg);	
					// console.log(data);
				}
			}
		);	


}



</script>

